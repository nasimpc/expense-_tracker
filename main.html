<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</head>

<body id="a" class="bg-success-subtle bg-gradient">
    <div class="card bg-primary-subtle" style="width: 1000px">
        <div class="card-body">
            <h2 class="card-title">Add Expenses</h2>
            <form onsubmit="saveToStorage(event)">
                <label calss="form-label"> Expense amount</label>
                <input id="amount" class="form-control" type="number" name="amount" required />
                <label calss="form-label"> Choose description</label>
                <input id="description" class="form-control" type="text" name="description" required />

                <label calss="form-label">Choose category
                    <select id="category" class="form-select" name="category">
                        <option value="" selected="selected">Select One</option>
                        <option value="fuel">fuel</option>
                        <option value="food">food</option>
                        <option value="electricity">electricity</option>
                        <option value="movie">movie</option>
                    </select>
                </label>
                <button class="btn btn-primary"> Add Expence </button><br>


            </form>
        </div>
    </div>
    <h2>Expenses</h2>
    <p id="b"></p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script>

        var body = document.getElementById('a');
        body.addEventListener('click', editItem);

        async function saveToStorage(e) {
            e.preventDefault();
            const amount = event.target.amount.value;
            const description = event.target.description.value;
            const category = event.target.category.value;
            //const userid = ;


            const obj = {
                userid: userid,
                amount: amount,
                description: description,
                category: category
            }

            let res = await axios.post("http://localhost:3000/expense/add-expense", obj);
            showNewExpenseOnScreen(res.data.newExpenseDetails)
        }
        window.addEventListener("DOMContentLoaded", async () => {

            let res = await axios.get("http://localhost:3000/expense/get-expenses");

            for (var i = 0; i < res.data.allExpenses.length; i++) {
                showNewExpenseOnScreen(res.data.allExpenses[i])
            }

        })

        //show details on screen
        function showNewExpenseOnScreen(obj, ID = '1qazx234rfvrrf') {
            if (obj['id']) {
                ID = obj['id']
            }
            var newText = document.createTextNode(obj['description'] + ' ' + obj['category'] + ' ' + obj['amount'] + ' ');

            // Add text to div
            var a = document.querySelector('#a');
            var b = document.querySelector('#b');

            var div0 = document.createElement('div');
            div0.className = "card col-4 bg-primary-subtle";
            var div = document.createElement('div');
            div.className = "card-body";

            div.id = ID;
            div.appendChild(newText);

            //delete btn
            var deleteBtn = document.createElement('button');

            deleteBtn.className = 'btn btn-sm btn-danger float-right delete';

            deleteBtn.appendChild(document.createTextNode('X'));

            div.appendChild(deleteBtn);

            div0.appendChild(div);

            a.insertBefore(div0, b);
        }
        // Remove item
        function editItem(e) {
            if (e.target.classList.contains('delete')) {
                if (confirm('Are You Sure?')) {
                    var div = e.target.parentElement.parentElement;
                    body.removeChild(div);
                    var id = e.target.parentElement.id;
                    axios.delete(`http://localhost:3000/expense/delete-expense/${id}`);
                }
            }

        }

    </script>
</body>

</html>